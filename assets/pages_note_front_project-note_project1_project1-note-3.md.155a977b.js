import{_ as s,o as n,c as a,d as l,e as p}from"./app.53099fc7.js";const F=JSON.parse('{"title":"实现全局水印功能","description":"","frontmatter":{},"headers":[],"relativePath":"pages/note/front/project-note/project1/project1-note-3.md","filePath":"pages/note/front/project-note/project1/project1-note-3.md","lastUpdated":1724312194000}'),o={name:"pages/note/front/project-note/project1/project1-note-3.md"},e=p(`<h1 id="实现全局水印功能" tabindex="-1">实现全局水印功能 <a class="header-anchor" href="#实现全局水印功能" aria-label="Permalink to &quot;实现全局水印功能&quot;">​</a></h1><blockquote><p>本项目的水印有以下几个要求</p><ul><li>在所有功能页面显示(即在登录注册页面不显示)</li><li>需要设置成可配置项,在若依框架中在服务端进行配置显示或者隐藏</li><li>水印需要显示用户信息</li><li>水印不能被遮挡,不能只设置成背景,并且不影响正常的业务点击</li><li>水印全屏显示,并且在滚动条滚动时,水印要一直存在</li></ul></blockquote><h2 id="若依框架配置水印是否显示" tabindex="-1">若依框架配置水印是否显示 <a class="header-anchor" href="#若依框架配置水印是否显示" aria-label="Permalink to &quot;若依框架配置水印是否显示&quot;">​</a></h2><ul><li>参数设置键值对,不显示为true,否则一直显示</li><li>在store中设置config配置,以便在全局获取参数</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { defineStore } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;pinia&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { listConfig } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@/api/system/config&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">useConfigStore</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defineStore</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  id: </span><span style="color:#9ECBFF;">&#39;config&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">state</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ({</span></span>
<span class="line"><span style="color:#E1E4E8;">    configList: []</span></span>
<span class="line"><span style="color:#E1E4E8;">  }),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  actions: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">getConfigList</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">resolve</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">reject</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> params </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          pageNum: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">          pageSize: </span><span style="color:#79B8FF;">999</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">listConfig</span><span style="color:#E1E4E8;">(params).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.configList </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> res.rows</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(res)</span></span>
<span class="line"><span style="color:#E1E4E8;">        }).</span><span style="color:#B392F0;">catch</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">error</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">(error)</span></span>
<span class="line"><span style="color:#E1E4E8;">        })</span></span>
<span class="line"><span style="color:#E1E4E8;">      })</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> useConfigStore</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用store获取参数列表</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useConfigStore } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@/store/modules/config.js&#39;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// store</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">configStoreData</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useConfigStore</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">configList</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> configStoreData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 如果水印参数为false,则不显示</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> waterMarkerConfig </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> configList.</span><span style="color:#B392F0;">filter</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> item.configKey </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;sys.waterMarker&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (waterMarkerConfig </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> waterMarkerConfig.configValue </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;false&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { defineStore } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;pinia&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { listConfig } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@/api/system/config&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">useConfigStore</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defineStore</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  id: </span><span style="color:#032F62;">&#39;config&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">state</span><span style="color:#24292E;">: () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> ({</span></span>
<span class="line"><span style="color:#24292E;">    configList: []</span></span>
<span class="line"><span style="color:#24292E;">  }),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  actions: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">getConfigList</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">((</span><span style="color:#E36209;">resolve</span><span style="color:#24292E;">, </span><span style="color:#E36209;">reject</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> params </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          pageNum: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          pageSize: </span><span style="color:#005CC5;">999</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">listConfig</span><span style="color:#24292E;">(params).</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">(</span><span style="color:#E36209;">res</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.configList </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> res.rows</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(res)</span></span>
<span class="line"><span style="color:#24292E;">        }).</span><span style="color:#6F42C1;">catch</span><span style="color:#24292E;">(</span><span style="color:#E36209;">error</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">reject</span><span style="color:#24292E;">(error)</span></span>
<span class="line"><span style="color:#24292E;">        })</span></span>
<span class="line"><span style="color:#24292E;">      })</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> useConfigStore</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用store获取参数列表</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { useConfigStore } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@/store/modules/config.js&#39;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">// store</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">configStoreData</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useConfigStore</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">configList</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> configStoreData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 如果水印参数为false,则不显示</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> waterMarkerConfig </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> configList.</span><span style="color:#6F42C1;">filter</span><span style="color:#24292E;">(</span><span style="color:#E36209;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> item.configKey </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;sys.waterMarker&#39;</span><span style="color:#24292E;">)[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (waterMarkerConfig </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> waterMarkerConfig.configValue </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;false&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="全局实现水印功能" tabindex="-1">全局实现水印功能 <a class="header-anchor" href="#全局实现水印功能" aria-label="Permalink to &quot;全局实现水印功能&quot;">​</a></h2><ul><li>新建水印js文件 ➡️ <code>@/utils/watermark.js</code></li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">watermark</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">settings</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 默认设置</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">defaultSettings</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_txt: </span><span style="color:#9ECBFF;">&quot;text&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_align: </span><span style="color:#9ECBFF;">&quot;left&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_x: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印起始位置x轴坐标</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_y: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印起始位置Y轴坐标</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_rows: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印行数</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_cols: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印列数</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_x_space: </span><span style="color:#79B8FF;">70</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印x轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_y_space: </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印y轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_color: </span><span style="color:#9ECBFF;">&#39;#aaa&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体颜色</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_alpha: </span><span style="color:#79B8FF;">0.4</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印透明度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_fontsize: </span><span style="color:#9ECBFF;">&#39;15px&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体大小</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_font: </span><span style="color:#9ECBFF;">&#39;微软雅黑&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_width: </span><span style="color:#79B8FF;">210</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印宽度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_height: </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印长度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_angle: </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">//水印倾斜度数</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (settings </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> settings </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;object&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> key </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> settings) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (settings[key] </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> defaultSettings[key] </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> settings[key] </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> defaultSettings[key]) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">continue</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (settings[key]) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                defaultSettings[key] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> settings[key];</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> oTemp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createDocumentFragment</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//获取页面最大宽度</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> page_width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(document.body.scrollWidth, document.body.clientWidth);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> cutWidth </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page_width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0150</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    page_width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page_width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> cutWidth;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//获取页面最大高度</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// let page_height = Math.max(document.body.scrollHeight, document.body.clientHeight) + 450;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> page_height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">450</span></span>
<span class="line"><span style="color:#E1E4E8;">    page_height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(page_height, window.innerHeight </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//如果将水印列数设置为0，或水印列数设置过大，超过页面最大宽度，则重新计算水印列数和水印x轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_cols </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(defaultSettings.watermark_x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_cols </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_cols </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> page_width)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_cols </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">((page_width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space));</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_x_space </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">((page_width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_cols) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_cols </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//如果将水印行数设置为0，或水印行数设置过大，超过页面最大长度，则重新计算水印行数和水印y轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_rows </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(defaultSettings.watermark_y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_rows </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y_space </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_rows </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> page_height)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_rows </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">((defaultSettings.watermark_y_space </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> page_height </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_height </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y_space));</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_y_space </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(((page_height </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_rows) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_rows </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> x;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> y;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_y_space </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> i) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">70</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; j </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> defaultSettings.watermark_cols; j</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> j;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> mask_div </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createElement</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;div&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mask_div&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> j;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.className </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mask_div&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.innerHTML </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_txt;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// mask_div.appendChild(document.createTextNode(defaultSettings.watermark_txt));</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//设置水印div倾斜显示</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.webkitTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.MozTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.msTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.OTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.transform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.visibility </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.position </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;absolute&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.left </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.top </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.overflow </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;hidden&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.zIndex </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;9999&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.pointerEvents </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;none&#39;</span><span style="color:#E1E4E8;">;  </span><span style="color:#6A737D;">//让水印不遮挡页面的点击事件</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.opacity </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_alpha;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.fontSize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_fontsize;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.fontFamily </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_font;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.color </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_color;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.textAlign </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_align;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.lineHeight </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;22px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.display </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;block&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            oTemp.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(mask_div);</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    document.body.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(oTemp);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> watermark;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> watermark </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./watermark.js&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermark.</span><span style="color:#B392F0;">setWatermark</span><span style="color:#E1E4E8;">()  </span><span style="color:#6A737D;">// 默认参数</span></span>
<span class="line"><span style="color:#E1E4E8;">watermark.</span><span style="color:#B392F0;">setWatermark</span><span style="color:#E1E4E8;">({ watermark_txt: </span><span style="color:#9ECBFF;">&#39;测试水印&#39;</span><span style="color:#E1E4E8;">, watermark_id: </span><span style="color:#9ECBFF;">&#39;wm_div_id&#39;</span><span style="color:#E1E4E8;">})  </span><span style="color:#6A737D;">// 自定义参数</span></span>
<span class="line"><span style="color:#6A737D;">// 里面任意参数都可以自定义,以对象的形式传入</span></span>
<span class="line"><span style="color:#E1E4E8;">watermark.</span><span style="color:#B392F0;">setWatermark</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_txt: </span><span style="color:#9ECBFF;">&quot;text&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_align: </span><span style="color:#9ECBFF;">&quot;left&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_x: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印起始位置x轴坐标</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_y: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印起始位置Y轴坐标</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_rows: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印行数</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_cols: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印列数</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_x_space: </span><span style="color:#79B8FF;">70</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印x轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_y_space: </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印y轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_color: </span><span style="color:#9ECBFF;">&#39;#aaa&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体颜色</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_alpha: </span><span style="color:#79B8FF;">0.4</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印透明度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_fontsize: </span><span style="color:#9ECBFF;">&#39;15px&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体大小</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_font: </span><span style="color:#9ECBFF;">&#39;微软雅黑&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_width: </span><span style="color:#79B8FF;">210</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印宽度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_height: </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印长度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_angle: </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">//水印倾斜度数</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">watermark</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">settings</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 默认设置</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">defaultSettings</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        watermark_txt: </span><span style="color:#032F62;">&quot;text&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        watermark_align: </span><span style="color:#032F62;">&quot;left&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        watermark_x: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印起始位置x轴坐标</span></span>
<span class="line"><span style="color:#24292E;">        watermark_y: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印起始位置Y轴坐标</span></span>
<span class="line"><span style="color:#24292E;">        watermark_rows: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印行数</span></span>
<span class="line"><span style="color:#24292E;">        watermark_cols: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印列数</span></span>
<span class="line"><span style="color:#24292E;">        watermark_x_space: </span><span style="color:#005CC5;">70</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印x轴间隔</span></span>
<span class="line"><span style="color:#24292E;">        watermark_y_space: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印y轴间隔</span></span>
<span class="line"><span style="color:#24292E;">        watermark_color: </span><span style="color:#032F62;">&#39;#aaa&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体颜色</span></span>
<span class="line"><span style="color:#24292E;">        watermark_alpha: </span><span style="color:#005CC5;">0.4</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印透明度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_fontsize: </span><span style="color:#032F62;">&#39;15px&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体大小</span></span>
<span class="line"><span style="color:#24292E;">        watermark_font: </span><span style="color:#032F62;">&#39;微软雅黑&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体</span></span>
<span class="line"><span style="color:#24292E;">        watermark_width: </span><span style="color:#005CC5;">210</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印宽度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_height: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印长度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_angle: </span><span style="color:#005CC5;">30</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">//水印倾斜度数</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (settings </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">typeof</span><span style="color:#24292E;"> settings </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;object&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> key </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> settings) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (settings[key] </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> defaultSettings[key] </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> settings[key] </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> defaultSettings[key]) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (settings[key]) {</span></span>
<span class="line"><span style="color:#24292E;">                defaultSettings[key] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> settings[key];</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> oTemp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">createDocumentFragment</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//获取页面最大宽度</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> page_width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(document.body.scrollWidth, document.body.clientWidth);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> cutWidth </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page_width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0150</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    page_width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page_width </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> cutWidth;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//获取页面最大高度</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// let page_height = Math.max(document.body.scrollHeight, document.body.clientHeight) + 450;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> page_height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">450</span></span>
<span class="line"><span style="color:#24292E;">    page_height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(page_height, window.innerHeight </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//如果将水印列数设置为0，或水印列数设置过大，超过页面最大宽度，则重新计算水印列数和水印x轴间隔</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (defaultSettings.watermark_cols </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(defaultSettings.watermark_x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_cols </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (defaultSettings.watermark_cols </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> page_width)) {</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_cols </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">((page_width </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_width </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space));</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_x_space </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">((page_width </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_x </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_cols) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_cols </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//如果将水印行数设置为0，或水印行数设置过大，超过页面最大长度，则重新计算水印行数和水印y轴间隔</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (defaultSettings.watermark_rows </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(defaultSettings.watermark_y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_height </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_rows </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_y_space </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (defaultSettings.watermark_rows </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> page_height)) {</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_rows </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">((defaultSettings.watermark_y_space </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> page_height </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_y) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_height </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_y_space));</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_y_space </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(((page_height </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_y) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_height </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_rows) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_rows </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> x;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> y;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        y </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (defaultSettings.watermark_y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (defaultSettings.watermark_y_space </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_height) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> i) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">70</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> j </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; j </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> defaultSettings.watermark_cols; j</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            x </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (defaultSettings.watermark_width </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> j;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> mask_div </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">createElement</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;div&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mask_div&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> j;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.className </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mask_div&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.innerHTML </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_txt;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// mask_div.appendChild(document.createTextNode(defaultSettings.watermark_txt));</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//设置水印div倾斜显示</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.webkitTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.MozTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.msTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.OTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.transform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.visibility </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.position </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;absolute&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.left </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.top </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.overflow </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;hidden&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.zIndex </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;9999&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.pointerEvents </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;none&#39;</span><span style="color:#24292E;">;  </span><span style="color:#6A737D;">//让水印不遮挡页面的点击事件</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.opacity </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_alpha;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.fontSize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_fontsize;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.fontFamily </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_font;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.color </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_color;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.textAlign </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_align;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.lineHeight </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;22px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_width </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_height </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.display </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;block&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            oTemp.</span><span style="color:#6F42C1;">appendChild</span><span style="color:#24292E;">(mask_div);</span></span>
<span class="line"><span style="color:#24292E;">        };</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"><span style="color:#24292E;">    document.body.</span><span style="color:#6F42C1;">appendChild</span><span style="color:#24292E;">(oTemp);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> watermark;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> watermark </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./watermark.js&#39;</span></span>
<span class="line"><span style="color:#24292E;">watermark.</span><span style="color:#6F42C1;">setWatermark</span><span style="color:#24292E;">()  </span><span style="color:#6A737D;">// 默认参数</span></span>
<span class="line"><span style="color:#24292E;">watermark.</span><span style="color:#6F42C1;">setWatermark</span><span style="color:#24292E;">({ watermark_txt: </span><span style="color:#032F62;">&#39;测试水印&#39;</span><span style="color:#24292E;">, watermark_id: </span><span style="color:#032F62;">&#39;wm_div_id&#39;</span><span style="color:#24292E;">})  </span><span style="color:#6A737D;">// 自定义参数</span></span>
<span class="line"><span style="color:#6A737D;">// 里面任意参数都可以自定义,以对象的形式传入</span></span>
<span class="line"><span style="color:#24292E;">watermark.</span><span style="color:#6F42C1;">setWatermark</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        watermark_txt: </span><span style="color:#032F62;">&quot;text&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        watermark_align: </span><span style="color:#032F62;">&quot;left&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        watermark_x: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印起始位置x轴坐标</span></span>
<span class="line"><span style="color:#24292E;">        watermark_y: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印起始位置Y轴坐标</span></span>
<span class="line"><span style="color:#24292E;">        watermark_rows: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印行数</span></span>
<span class="line"><span style="color:#24292E;">        watermark_cols: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印列数</span></span>
<span class="line"><span style="color:#24292E;">        watermark_x_space: </span><span style="color:#005CC5;">70</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印x轴间隔</span></span>
<span class="line"><span style="color:#24292E;">        watermark_y_space: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印y轴间隔</span></span>
<span class="line"><span style="color:#24292E;">        watermark_color: </span><span style="color:#032F62;">&#39;#aaa&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体颜色</span></span>
<span class="line"><span style="color:#24292E;">        watermark_alpha: </span><span style="color:#005CC5;">0.4</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印透明度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_fontsize: </span><span style="color:#032F62;">&#39;15px&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体大小</span></span>
<span class="line"><span style="color:#24292E;">        watermark_font: </span><span style="color:#032F62;">&#39;微软雅黑&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体</span></span>
<span class="line"><span style="color:#24292E;">        watermark_width: </span><span style="color:#005CC5;">210</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印宽度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_height: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印长度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_angle: </span><span style="color:#005CC5;">30</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">//水印倾斜度数</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br></div></div><ul><li>这时候基本的水印功能差不多完成了</li><li>注意点: <ul><li>css设置<code>pointerEvents: none</code>,可以让业务代码点击水印的时候不触发点击事件</li><li>在若依框架的layout文件下面使用,可以作用到全局业务代码上</li></ul></li></ul><h2 id="遇到问题并解决问题" tabindex="-1">遇到问题并解决问题 <a class="header-anchor" href="#遇到问题并解决问题" aria-label="Permalink to &quot;遇到问题并解决问题&quot;">​</a></h2><ul><li>如果页面很长,水印会只显示一部分,所以需要设置水印的高度,让水印可以显示在页面的最底部 <ul><li>所以这时候需要给滚动条比较长的页面传入一个高度,让水印可以显示在页面的最底部</li></ul></li><li>其他页面如何通知layout组件来重新渲染水印</li><li>因为页面一开始就渲染了水印,设置具体页面高度之后,水印会重复渲染</li><li>因为页面一加载就会显示水印,并且只执行一次,如果设置具体页面高度之后,在其他正常页面高度不会进行相对应的变化</li></ul><h3 id="如何设置水印高度" tabindex="-1">如何设置水印高度 <a class="header-anchor" href="#如何设置水印高度" aria-label="Permalink to &quot;如何设置水印高度&quot;">​</a></h3><ul><li>我们需要将高度传入进去,同时我们也需要自定义水印内容,代码作如下修改</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">watermark_height</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">nickName</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">phonenumber</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> userStoreData.userMseeage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">watermark</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    watermark_txt: </span><span style="color:#9ECBFF;">\`&lt;p&gt;\${</span><span style="color:#E1E4E8;">nickName</span><span style="color:#9ECBFF;">}&lt;br /&gt;\${</span><span style="color:#E1E4E8;">phonenumber</span><span style="color:#9ECBFF;">}&lt;/p&gt;\`</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    watermark_height</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">watermark_height</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">nickName</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">phonenumber</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> userStoreData.userMseeage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">watermark</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    watermark_txt: </span><span style="color:#032F62;">\`&lt;p&gt;\${</span><span style="color:#24292E;">nickName</span><span style="color:#032F62;">}&lt;br /&gt;\${</span><span style="color:#24292E;">phonenumber</span><span style="color:#032F62;">}&lt;/p&gt;\`</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    watermark_height</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="其他页面通知-订阅-layout组件渲染水印" tabindex="-1">其他页面通知(订阅)layout组件渲染水印 <a class="header-anchor" href="#其他页面通知-订阅-layout组件渲染水印" aria-label="Permalink to &quot;其他页面通知(订阅)layout组件渲染水印&quot;">​</a></h3><ul><li>我们使用mitt工具来进行发布订阅事件</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// &#39;@/utils/mittBus.js&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> mitt </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;mitt&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">mittBus</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mitt</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> mittBus;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// setWaterMarker方法不变,我们在订阅中调用该方法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// layout组件</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> mittBus </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@/utils/mittBus.js&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> watermark </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@/utils/watermark.js&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">mittBus.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;setWaterMarker&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">watermark_height</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;设置水印&quot;</span><span style="color:#E1E4E8;">, watermark_height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;">(watermark_height)</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 其他页面</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> mittBus </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@/utils/mittBus.js&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">mittBus.</span><span style="color:#B392F0;">emit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;setWaterMarker&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">130</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// &#39;@/utils/mittBus.js&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> mitt </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;mitt&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mittBus</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mitt</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> mittBus;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// setWaterMarker方法不变,我们在订阅中调用该方法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// layout组件</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> mittBus </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@/utils/mittBus.js&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> watermark </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@/utils/watermark.js&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">mittBus.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;setWaterMarker&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">watermark_height</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;设置水印&quot;</span><span style="color:#24292E;">, watermark_height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;">(watermark_height)</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 其他页面</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> mittBus </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@/utils/mittBus.js&#39;</span></span>
<span class="line"><span style="color:#24292E;">mittBus.</span><span style="color:#6F42C1;">emit</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;setWaterMarker&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">130</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="在每次设置水印之前先进行初始化" tabindex="-1">在每次设置水印之前先进行初始化 <a class="header-anchor" href="#在每次设置水印之前先进行初始化" aria-label="Permalink to &quot;在每次设置水印之前先进行初始化&quot;">​</a></h3><ul><li>水印是通过生成dom来进行显示的,我们在生成水印之前,先判断是否存在水印,如果存在先进行晴空,代码如下</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">maskDivList</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">querySelectorAll</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.mask_div&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">maskDivList.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    item.</span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">maskDivList</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">querySelectorAll</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;.mask_div&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">maskDivList.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">(</span><span style="color:#E36209;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    item.</span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="监听路由-保证每次跳转重新渲染水印" tabindex="-1">监听路由,保证每次跳转重新渲染水印 <a class="header-anchor" href="#监听路由-保证每次跳转重新渲染水印" aria-label="Permalink to &quot;监听路由,保证每次跳转重新渲染水印&quot;">​</a></h3><ul><li>为了保证我们改变高度渲染水印之后不影响其他页面水印的渲染情况,得对路由进行监听,在特别长的页面需要修改水印高度,其他页面则使用默认值</li><li>我们使用<code>router.beforeEach</code>这个钩子来对路由进行监听,并且把mitt事件放到路由守卫当中</li><li>同时为了判断当前是否需要进行派发事件,需要使用一个标识进行判断,代码如下</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useRouter </span><span style="color:#6A737D;">/* useRoute */</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;vue-router&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useRouter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">beforeEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">to</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">from</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">next</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// console.log(&#39;路由即将改变：&#39;, from.path, &#39;-&gt;&#39;, to.path);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> flag </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  mittBus.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;setWaterMarker&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">watermark_height</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;设置水印&quot;</span><span style="color:#E1E4E8;">, watermark_height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    flag </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;">(watermark_height)</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { useRouter </span><span style="color:#6A737D;">/* useRoute */</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;vue-router&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useRouter</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">beforeEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">to</span><span style="color:#24292E;">, </span><span style="color:#E36209;">from</span><span style="color:#24292E;">, </span><span style="color:#E36209;">next</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// console.log(&#39;路由即将改变：&#39;, from.path, &#39;-&gt;&#39;, to.path);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> flag </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  mittBus.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;setWaterMarker&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">watermark_height</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;设置水印&quot;</span><span style="color:#24292E;">, watermark_height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    flag </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;">(watermark_height)</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="最终代码" tabindex="-1">最终代码 <a class="header-anchor" href="#最终代码" aria-label="Permalink to &quot;最终代码&quot;">​</a></h2><ul><li><code>@/utils/watermark.js</code></li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useConfigStore } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@/store/modules/config.js&#39;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// store</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">watermark</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">settings</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">configStoreData</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useConfigStore</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> waterMarkerConfig </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> configStoreData.configList.</span><span style="color:#B392F0;">filter</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> item.configKey </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;sys.waterMarker&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (waterMarkerConfig </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> waterMarkerConfig.configValue </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;false&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> maskDivList </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">querySelectorAll</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.mask_div&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    maskDivList.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        item.</span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 默认设置</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">defaultSettings</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_txt: </span><span style="color:#9ECBFF;">&quot;text&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_align: </span><span style="color:#9ECBFF;">&quot;left&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_x: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印起始位置x轴坐标</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_y: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印起始位置Y轴坐标</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_rows: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印行数</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_cols: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印列数</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_x_space: </span><span style="color:#79B8FF;">70</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印x轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_y_space: </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印y轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_color: </span><span style="color:#9ECBFF;">&#39;#aaa&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体颜色</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_alpha: </span><span style="color:#79B8FF;">0.4</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印透明度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_fontsize: </span><span style="color:#9ECBFF;">&#39;15px&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体大小</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_font: </span><span style="color:#9ECBFF;">&#39;微软雅黑&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印字体</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_width: </span><span style="color:#79B8FF;">210</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印宽度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_height: </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//水印长度</span></span>
<span class="line"><span style="color:#E1E4E8;">        watermark_angle: </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">//水印倾斜度数</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (settings </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> settings </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;object&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> key </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> settings) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (settings[key] </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> defaultSettings[key] </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> settings[key] </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> defaultSettings[key]) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">continue</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (settings[key]) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                defaultSettings[key] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> settings[key];</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> oTemp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createDocumentFragment</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//获取页面最大宽度</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> page_width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(document.body.scrollWidth, document.body.clientWidth);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> cutWidth </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page_width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0150</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    page_width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page_width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> cutWidth;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//获取页面最大高度</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// let page_height = Math.max(document.body.scrollHeight, document.body.clientHeight) + 450;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> page_height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">450</span></span>
<span class="line"><span style="color:#E1E4E8;">    page_height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(page_height, window.innerHeight </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// console.log(page_height)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//如果将水印列数设置为0，或水印列数设置过大，超过页面最大宽度，则重新计算水印列数和水印x轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_cols </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(defaultSettings.watermark_x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_cols </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_cols </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> page_width)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_cols </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">((page_width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space));</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_x_space </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">((page_width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_cols) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_cols </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//如果将水印行数设置为0，或水印行数设置过大，超过页面最大长度，则重新计算水印行数和水印y轴间隔</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_rows </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(defaultSettings.watermark_y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_rows </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y_space </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_rows </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> page_height)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_rows </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">((defaultSettings.watermark_y_space </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> page_height </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_height </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y_space));</span></span>
<span class="line"><span style="color:#E1E4E8;">        defaultSettings.watermark_y_space </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(((page_height </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_y) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> defaultSettings.watermark_rows) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_rows </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> x;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> y;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_y_space </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> i) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">70</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; j </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> defaultSettings.watermark_cols; j</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (defaultSettings.watermark_width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_x_space) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> j;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> mask_div </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createElement</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;div&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mask_div&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> j;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.className </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mask_div&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.innerHTML </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_txt;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// mask_div.appendChild(document.createTextNode(defaultSettings.watermark_txt));</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//设置水印div倾斜显示</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.webkitTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.MozTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.msTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.OTransform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.transform </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;rotate(-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> defaultSettings.watermark_angle </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deg)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.visibility </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.position </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;absolute&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.left </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.top </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.overflow </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;hidden&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.zIndex </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;9999&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//让水印不遮挡页面的点击事件</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.pointerEvents </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;none&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.opacity </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_alpha;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.fontSize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_fontsize;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.fontFamily </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_font;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.color </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_color;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.textAlign </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_align;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.lineHeight </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;22px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> defaultSettings.watermark_height </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;px&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            mask_div.style.display </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;block&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            oTemp.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(mask_div);</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    document.body.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(oTemp);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> watermark;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { useConfigStore } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@/store/modules/config.js&#39;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">// store</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">watermark</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">settings</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">configStoreData</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useConfigStore</span><span style="color:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> waterMarkerConfig </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> configStoreData.configList.</span><span style="color:#6F42C1;">filter</span><span style="color:#24292E;">(</span><span style="color:#E36209;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> item.configKey </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;sys.waterMarker&#39;</span><span style="color:#24292E;">)[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (waterMarkerConfig </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> waterMarkerConfig.configValue </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;false&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> maskDivList </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">querySelectorAll</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;.mask_div&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    maskDivList.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">(</span><span style="color:#E36209;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        item.</span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 默认设置</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">defaultSettings</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        watermark_txt: </span><span style="color:#032F62;">&quot;text&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        watermark_align: </span><span style="color:#032F62;">&quot;left&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        watermark_x: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印起始位置x轴坐标</span></span>
<span class="line"><span style="color:#24292E;">        watermark_y: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印起始位置Y轴坐标</span></span>
<span class="line"><span style="color:#24292E;">        watermark_rows: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印行数</span></span>
<span class="line"><span style="color:#24292E;">        watermark_cols: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印列数</span></span>
<span class="line"><span style="color:#24292E;">        watermark_x_space: </span><span style="color:#005CC5;">70</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印x轴间隔</span></span>
<span class="line"><span style="color:#24292E;">        watermark_y_space: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印y轴间隔</span></span>
<span class="line"><span style="color:#24292E;">        watermark_color: </span><span style="color:#032F62;">&#39;#aaa&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体颜色</span></span>
<span class="line"><span style="color:#24292E;">        watermark_alpha: </span><span style="color:#005CC5;">0.4</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印透明度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_fontsize: </span><span style="color:#032F62;">&#39;15px&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体大小</span></span>
<span class="line"><span style="color:#24292E;">        watermark_font: </span><span style="color:#032F62;">&#39;微软雅黑&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印字体</span></span>
<span class="line"><span style="color:#24292E;">        watermark_width: </span><span style="color:#005CC5;">210</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印宽度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_height: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//水印长度</span></span>
<span class="line"><span style="color:#24292E;">        watermark_angle: </span><span style="color:#005CC5;">30</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">//水印倾斜度数</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (settings </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">typeof</span><span style="color:#24292E;"> settings </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;object&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> key </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> settings) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (settings[key] </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> defaultSettings[key] </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> settings[key] </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> defaultSettings[key]) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (settings[key]) {</span></span>
<span class="line"><span style="color:#24292E;">                defaultSettings[key] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> settings[key];</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> oTemp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">createDocumentFragment</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//获取页面最大宽度</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> page_width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(document.body.scrollWidth, document.body.clientWidth);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> cutWidth </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page_width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0150</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    page_width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page_width </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> cutWidth;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//获取页面最大高度</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// let page_height = Math.max(document.body.scrollHeight, document.body.clientHeight) + 450;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> page_height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">450</span></span>
<span class="line"><span style="color:#24292E;">    page_height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(page_height, window.innerHeight </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// console.log(page_height)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//如果将水印列数设置为0，或水印列数设置过大，超过页面最大宽度，则重新计算水印列数和水印x轴间隔</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (defaultSettings.watermark_cols </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(defaultSettings.watermark_x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_cols </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (defaultSettings.watermark_cols </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> page_width)) {</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_cols </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">((page_width </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_width </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space));</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_x_space </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">((page_width </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_x </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_cols) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_cols </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//如果将水印行数设置为0，或水印行数设置过大，超过页面最大长度，则重新计算水印行数和水印y轴间隔</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (defaultSettings.watermark_rows </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(defaultSettings.watermark_y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_height </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_rows </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_y_space </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (defaultSettings.watermark_rows </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> page_height)) {</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_rows </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">((defaultSettings.watermark_y_space </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> page_height </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_y) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_height </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_y_space));</span></span>
<span class="line"><span style="color:#24292E;">        defaultSettings.watermark_y_space </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(((page_height </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_y) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> defaultSettings.watermark_height </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> defaultSettings.watermark_rows) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (defaultSettings.watermark_rows </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> x;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> y;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        y </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (defaultSettings.watermark_y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (defaultSettings.watermark_y_space </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_height) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> i) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">70</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> j </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; j </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> defaultSettings.watermark_cols; j</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            x </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (defaultSettings.watermark_width </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_x_space) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> j;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> mask_div </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">createElement</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;div&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mask_div&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> j;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.className </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mask_div&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.innerHTML </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_txt;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// mask_div.appendChild(document.createTextNode(defaultSettings.watermark_txt));</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//设置水印div倾斜显示</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.webkitTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.MozTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.msTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.OTransform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.transform </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;rotate(-&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> defaultSettings.watermark_angle </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deg)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.visibility </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.position </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;absolute&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.left </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> x </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.top </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> y </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.overflow </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;hidden&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.zIndex </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;9999&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//让水印不遮挡页面的点击事件</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.pointerEvents </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;none&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.opacity </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_alpha;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.fontSize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_fontsize;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.fontFamily </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_font;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.color </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_color;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.textAlign </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_align;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.lineHeight </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;22px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_width </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> defaultSettings.watermark_height </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;px&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            mask_div.style.display </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;block&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            oTemp.</span><span style="color:#6F42C1;">appendChild</span><span style="color:#24292E;">(mask_div);</span></span>
<span class="line"><span style="color:#24292E;">        };</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"><span style="color:#24292E;">    document.body.</span><span style="color:#6F42C1;">appendChild</span><span style="color:#24292E;">(oTemp);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> watermark;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br></div></div><ul><li><code>layout/index.vue</code></li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useRouter } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;vue-router&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> mittBus </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@/utils/mittBus&quot;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// mitt - 组件传参工具</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useRouter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 路由监听,并接收其他组件派发的方法</span></span>
<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">beforeEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">to</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">from</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">next</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> flag </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  mittBus.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;setWaterMarker&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">watermark_height</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;设置水印&quot;</span><span style="color:#E1E4E8;">, watermark_height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    flag </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;">(watermark_height)</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(&#39;路由即将改变：&#39;, from.path, &#39;-&gt;&#39;, to.path);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">next</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 设置水印</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">watermark_height</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">nickName</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">phonenumber</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> userStoreData.userMseeage</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(userStoreData, nickName, phonenumber)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">watermark</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    watermark_txt: </span><span style="color:#9ECBFF;">\`&lt;p&gt;\${</span><span style="color:#E1E4E8;">nickName</span><span style="color:#9ECBFF;">}&lt;br /&gt;\${</span><span style="color:#E1E4E8;">phonenumber</span><span style="color:#9ECBFF;">}&lt;/p&gt;\`</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    watermark_height</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#B392F0;">setWaterMarker</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { useRouter } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;vue-router&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> mittBus </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@/utils/mittBus&quot;</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// mitt - 组件传参工具</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useRouter</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 路由监听,并接收其他组件派发的方法</span></span>
<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">beforeEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">to</span><span style="color:#24292E;">, </span><span style="color:#E36209;">from</span><span style="color:#24292E;">, </span><span style="color:#E36209;">next</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> flag </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  mittBus.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;setWaterMarker&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">watermark_height</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;设置水印&quot;</span><span style="color:#24292E;">, watermark_height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    flag </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;">(watermark_height)</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(&#39;路由即将改变：&#39;, from.path, &#39;-&gt;&#39;, to.path);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">next</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * 设置水印</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">watermark_height</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">nickName</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">phonenumber</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> userStoreData.userMseeage</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(userStoreData, nickName, phonenumber)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">watermark</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    watermark_txt: </span><span style="color:#032F62;">\`&lt;p&gt;\${</span><span style="color:#24292E;">nickName</span><span style="color:#032F62;">}&lt;br /&gt;\${</span><span style="color:#24292E;">phonenumber</span><span style="color:#032F62;">}&lt;/p&gt;\`</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    watermark_height</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6F42C1;">setWaterMarker</span><span style="color:#24292E;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><ul><li>最终具体页面使用</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> mittBus </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@/utils/mittBus&quot;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// mitt - 组件传参工具</span></span>
<span class="line"><span style="color:#E1E4E8;">mittBus.</span><span style="color:#B392F0;">emit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;setWaterMarker&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">130</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> mittBus </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@/utils/mittBus&quot;</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// mitt - 组件传参工具</span></span>
<span class="line"><span style="color:#24292E;">mittBus.</span><span style="color:#6F42C1;">emit</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;setWaterMarker&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">130</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="最后的彩蛋" tabindex="-1">最后的彩蛋 <a class="header-anchor" href="#最后的彩蛋" aria-label="Permalink to &quot;最后的彩蛋&quot;">​</a></h2><ul><li>最后发现以上的方案还是有问题,痛定思痛,换了个角度思考</li><li>能不能让水印固定在页面上不随页面的滚动而滚动</li><li>将上面的代码作如下变化</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> watermarker_wrap </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createElement</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;div&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.position </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;fixed&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.top </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;0&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.left </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;0&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;100%&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;100%&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.zIndex </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;999999&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.style.pointerEvents </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;none&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">document.body.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(watermarker_wrap);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ......</span></span>
<span class="line"><span style="color:#E1E4E8;">watermarker_wrap.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(oTemp);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> watermarker_wrap </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">createElement</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;div&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.position </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;fixed&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.top </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;0&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.left </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;0&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;100%&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;100%&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.zIndex </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;999999&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.style.pointerEvents </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;none&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">document.body.</span><span style="color:#6F42C1;">appendChild</span><span style="color:#24292E;">(watermarker_wrap);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ......</span></span>
<span class="line"><span style="color:#24292E;">watermarker_wrap.</span><span style="color:#6F42C1;">appendChild</span><span style="color:#24292E;">(oTemp);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>但转念一想,如果只是遍历水印内容,用css固定,完全可以不用这么麻烦</li></ul><div class="language-vue vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">v-if</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(urlObj) </span><span style="color:#F97583;">!==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{}&#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;watermarker_wrap&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;div class=&quot;item_warp&quot;  v-for=&quot;(item1, i1) in 8&quot; :key=&quot;i1&quot; :style=&quot;\`top:\${140 * i1}px\`&quot;&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;div class=&quot;item&quot; v-for=&quot;(item, i) in 10&quot; :key=&quot;i&quot; :style=&quot;\`left:\${200 * i + 20}px\`&quot;&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;p style=&quot;margin-bottom: 3px&quot;&gt;{{ urlObj.userName }}&amp;nbsp;&amp;nbsp;{{ urlObj.suffixPhone }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;p&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        {{ \`\${new Date().getFullYear()}\`.slice(2) }}</span></span>
<span class="line"><span style="color:#E1E4E8;">        {{ \`\${new Date().getMonth() + 1}\`.padStart(2, &quot;0&quot;) }}</span></span>
<span class="line"><span style="color:#E1E4E8;">        {{ \`\${new Date().getDate()}\`.padStart(2, &quot;0&quot;) }}</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/p&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">style</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">.watermarker_wrap</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">position</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">fixed</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">width</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">100</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">height</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1080</span><span style="color:#F97583;">px</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">top</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">left</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">z-index</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">999999</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">pointer-events</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">none</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  .</span><span style="color:#79B8FF;">item</span><span style="color:#E1E4E8;">_</span><span style="color:#79B8FF;">warp</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">position</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">absolute</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">height</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">50</span><span style="color:#F97583;">px</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">width</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">100</span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">left</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#79B8FF;">item</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">position</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">absolute</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">top</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span><span style="color:#F97583;">px</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">font-size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">14</span><span style="color:#F97583;">px</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">font-weight</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">400</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">color</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">rgba</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0.2</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">transform</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">rotateZ</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">-25</span><span style="color:#F97583;">deg</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">style</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">v-if</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">(urlObj) </span><span style="color:#D73A49;">!==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{}&#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;watermarker_wrap&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;div class=&quot;item_warp&quot;  v-for=&quot;(item1, i1) in 8&quot; :key=&quot;i1&quot; :style=&quot;\`top:\${140 * i1}px\`&quot;&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;div class=&quot;item&quot; v-for=&quot;(item, i) in 10&quot; :key=&quot;i&quot; :style=&quot;\`left:\${200 * i + 20}px\`&quot;&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;p style=&quot;margin-bottom: 3px&quot;&gt;{{ urlObj.userName }}&amp;nbsp;&amp;nbsp;{{ urlObj.suffixPhone }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;p&gt;</span></span>
<span class="line"><span style="color:#24292E;">        {{ \`\${new Date().getFullYear()}\`.slice(2) }}</span></span>
<span class="line"><span style="color:#24292E;">        {{ \`\${new Date().getMonth() + 1}\`.padStart(2, &quot;0&quot;) }}</span></span>
<span class="line"><span style="color:#24292E;">        {{ \`\${new Date().getDate()}\`.padStart(2, &quot;0&quot;) }}</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/p&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">style</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">.watermarker_wrap</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">position</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">fixed</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">width</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">100</span><span style="color:#D73A49;">%</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">height</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1080</span><span style="color:#D73A49;">px</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">top</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">left</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">z-index</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">999999</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">pointer-events</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">none</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  .</span><span style="color:#005CC5;">item</span><span style="color:#24292E;">_</span><span style="color:#005CC5;">warp</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">position</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">absolute</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">height</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">50</span><span style="color:#D73A49;">px</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">width</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">100</span><span style="color:#D73A49;">%</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">left</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#005CC5;">item</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">position</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">absolute</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">top</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span><span style="color:#D73A49;">px</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">font-size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">14</span><span style="color:#D73A49;">px</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">font-weight</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">400</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">color</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">rgba</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">255</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">255</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0.2</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">transform</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">rotateZ</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">-25</span><span style="color:#D73A49;">deg</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">style</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><br>`,36);function t(r,c,E,y,i,m){return n(),a("div",null,[e,l(" 🤣 🤣 🤣 🐶 🐶 🐶")])}const b=s(o,[["render",t]]);export{F as __pageData,b as default};
//# sourceMappingURL=pages_note_front_project-note_project1_project1-note-3.md.155a977b.js.map
